# Registration

1. Делаем url для регистрации, например, "/register".
2. Делаем функцию валидации body как мидлевере, чтобы не валидные запросы не попадали в контроллер.

- для валидации делаем схему валидации, используя Joi;
- в функции проверяем body на пустоту и на сооветствие прокинутой схеме;

3. Если запрос прошел валидацию, то отправляем его в в контроллер.
4. Делаем контроллер для данного url.
5. В контроллере:

- пришедший пароль хэшуем с помощью bcrypt;
- создаем юзера из body и хеш-пароля и записываем его в БД;
- если юзер записался, то возвращаем ответ на фронтенд;

## Database User

1. Для работы с Database используем mongoose.
2. Создаем модель на основании Schema.
3. В Schema прописываются все поля, которые будут в Database.
4. В случае ошибки при записи в БД нам нужно выкинуть ошибку 400. Это можно сделать только через мидлевере.
5. Делаем мидлевере для обработки ошибки при записи в БД.

# Login

1. Делаем url для логина, например, "/login".
2. Делаем функцию валидации body как мидлевере, чтобы не валидные запросы не попадали в контроллер.

- для валидации делаем схему валидации, используя Joi;
- в функции проверяем body на пустоту и на сооветствие прокинутой схеме;

3. Если запрос прошел валидацию, то отправляем его в в контроллер.
4. Делаем контроллер для данного url.
5. В контроллере:

- ищем по емайл юзера в БД, если есть идем дальше;
- сверяем полученный пароль с тем, который в БД, если совпал идем дальше;
- делаем токен с помощью jsonwebtoken на основании айди юзера и серетного слова;
- записываем токен в БД к юзеру;
- возвращаем ответ на фронтенд.

# Logout

1. Делаем url для логаута, например, "/logout".
2. Делаем функцию мидлевере на проверку, что юзер авторизирован (описано ниже).
3. Если запрос прошел валидацию, то отправляем его в в контроллер.
4. В контроллере обращаемся к БД User и устанавливаем токен - "".

## Database Contact

1. Для работы с Database используем mongoose.
2. Создаем модель на основании Schema.
3. В Schema прописываются все поля, которые будут в Database.
4. В случае ошибки при записи в БД нам нужно выкинуть ошибку 400. Это можно сделать только через мидлевере.
5. Делаем мидлевере для обработки ошибки при записи в БД.

# Работа с Database Contact

1. Делаем url для (GET, POST, PUT/PATCH, DELETE)
2. Для проверки валидности id в url делаем мидлевере на основании метода isValidObjectId из mongoose.
3. Для доступа к БД только авторизированных юзеров делаем мидлевере. В этом мидлевере:

- проверяем пришел ли к нам токен;
- проверяем валидность и протухлось токена;
- проверяем по id есть ли такой юзер в БД, есть ли у него токен, и этот токен такой как пришел и ли нет;
- если проверки пройдены, то в контакт в БД Contact добавляем юзера, который его создал

4. Если запрос прошел валидацию, то отправляем его в в контроллер.
5. Делаем контроллер для данного url.
6. В контроллере:

- в зависимости от метода запроса, получаем данные из БД и возвращаем их в фронтенд

7. Для пагинации из строки запроса достаем qwery и по значениям возвращаем нужные страницы.

# Робота з файлами

1. npm install multer
2. Ствоюємо мідлеваре, у який кажемо з якої папки потрібно віддавати статику клієнту
   app.use(express.static("public"))
3. Створюємо папки temp/.gitkeep && public/avatars/.gitkeep
4. Створюємо мидлеваре upload.js с настройками, в яких вказуємо абсолют шлях де тимчасово зберігається статика та під яким ім'ям, якщо треба змінити ім'я файлу.
5. Змінюємо модель юзера додавши властивість avatarURL
6. Реалізувати логіку де юзеру за замовучування дається при реєстрації дефолтна аватарка, яку потім він зможе змінити
7. Для генерування аватрки використовуємо
   npm i gravatar
8. Створюємо url для зміни дефолтної аватарки користувачем методом PUTCH
9. Створюємо контроллер. У контролері:

- з боді читаємо старий шлях
- створюємо новий шлях де будемо зберігати файл(public)
- ім'я файлу робимо унікальним
- переміщуємо файл
- записуємо новий шлях у БД
